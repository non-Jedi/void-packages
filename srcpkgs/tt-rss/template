# Template file for 'tt-rss'
pkgname=tt-rss
version=19.8
revision=1
archs=noarch
wrksrc=tt-rss
depends="php postgresql"
short_desc="Web-based RSS/Atom reader and aggregator"
maintainer="Adam Beckmeyer <adam_gpg@thebeckmeyers.xyz>"
license="GPL-3.0-only"
homepage="https://tt-rss.org"
distfiles="https://git.tt-rss.org/fox/tt-rss/archive/${version}.tar.gz"
checksum=df8792d759a3ccd6088ca6e071d146ca51fbc0ccd88bb8b369e01248fc232968
conf_files="/etc/webapps/tt-rss/config.php"
system_accounts="_ttrss"

do_install() {
	vmkdir var/lib/tt-rss
	mv ${wrksrc}/{lock,feed-icons,cache} ${DESTDIR}/var/lib/tt-rss

	vmkdir usr/share/webapps/
	vcopy ${wrksrc} usr/share/webapps/tt-rss

	ln -s /var/lib/tt-rss/lock ${DESTDIR}/usr/share/webapps/tt-rss/lock
	ln -s /var/lib/tt-rss/feed-icons ${DESTDIR}/usr/share/webapps/tt-rss/feed-icons
	ln -s /var/lib/tt-rss/cache ${DESTDIR}/usr/share/webapps/tt-rss/cache

	vinstall config.php-dist 644 /etc/webapps/tt-rss/ config.php
	ln -s /etc/webapps/tt-rss/config.php ${DESTDIR}/usr/share/webapps/tt-rss/

	vsv tt-rss-update
}

post_install() {
	# Allow access to /var/lib/tt-rss/ for _ttrss group
	chmod -R 2775 ${DESTDIR}/var/lib/tt-rss/
}
