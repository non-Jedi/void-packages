# Template file for 'hyperscan'
pkgname=hyperscan
version=5.1.1
revision=1
# Intel project only supports intel architectures
archs="x86_64* i686*"
build_style=cmake
configure_args="-DBUILD_STATIC_AND_SHARED=1"
hostmakedepends="ragel python"
makedepends="boost-devel"
short_desc="High-performance regular expression matching library"
maintainer="Adam Beckmeyer <adam_gpg@thebeckmeyers.xyz>"
license="BSD-3-Clause"
homepage="https://www.hyperscan.io"
distfiles="https://github.com/intel/hyperscan/archive/v${version}.tar.gz"
checksum=e3bb509d4002f2d75e1804e754efa6334316d1ee110a3b85c8156c08fe5e2369

# musl doesn't support ifunc so hyperscan can't build "fat runtime"
case "$XBPS_TARGET_MACHINE" in
i686-musl)
	export CFLAGS="-march=pentium4"
	export CXXFLAGS="-march=pentium4"
	;;
x86_64-musl)
	export CFLAGS="-march=x86-64"
	export CXXFLAGS="-march=x86-64"
	;;
esac

post_install() {
	vlicense COPYING
}

hyperscan-devel_package() {
	short_desc+=" - development files"
	depends="${sourcepkg}>=${version}_${revision}"
	pkg_install() {
		vmove usr/include
		vmove "usr/lib/*.a"
		vmove "usr/lib/*.so"
		vmove usr/lib/pkgconfig
	}
}

hyperscan-doc_package() {
	short_desc+=" - documentation files"
	archs=noarch
	depends="${sourcepkg}>=${version}_${revision}"
	pkg_install() {
		vmove usr/share
	}
}
